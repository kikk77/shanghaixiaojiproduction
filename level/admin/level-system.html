<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­‰çº§ç³»ç»Ÿç®¡ç†ä¸­å¿ƒ</title>
    <link rel="stylesheet" href="/level/admin/styles/level-system.css">
    <style>
        /* åŸºç¡€æ ·å¼ */
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ç³»ç»ŸçŠ¶æ€ */
        .system-status {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-enabled { background: #d4edda; color: #155724; padding: 5px 10px; border-radius: 3px; }
        .status-disabled { background: #f8d7da; color: #721c24; padding: 5px 10px; border-radius: 3px; }
        
        /* æ ‡ç­¾é¡µ */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: #f8f9fa;
            border-radius: 5px 5px 0 0;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .tab:hover { background: #e9ecef; }
        .tab.active { background: #2196F3; color: white; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* è¡¨å•æ ·å¼ */
        .form-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 15px 0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-primary { background: #2196F3; color: white; }
        .btn-primary:hover { background: #1976D2; }
        
        .btn-success { background: #4CAF50; color: white; }
        .btn-success:hover { background: #388E3C; }
        
        .btn-warning { background: #FF9800; color: white; }
        .btn-warning:hover { background: #F57C00; }
        
        .btn-danger { background: #f44336; color: white; }
        .btn-danger:hover { background: #D32F2F; }
        
        /* è¡¨æ ¼æ ·å¼ */
        .config-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .config-table th,
        .config-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .config-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .config-table tr:hover {
            background: #f5f5f5;
        }
        
        /* è­¦å‘Šæ¡† */
        .warning-box {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }
        
        /* æˆåŠŸæ¡† */
        .success-box {
            background: #d4edda;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        
        /* ä¿¡æ¯æ¡† */
        .info-box {
            background: #d1ecf1;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #17a2b8;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #666;
            font-size: 14px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #2196F3;
        }
        
        /* å‹‹ç« æ ·å¼ */
        .badge-item {
            display: inline-block;
            background: #fff3cd;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 20px;
            border: 1px solid #ffeaa7;
        }
        
        .badge-rarity-common { background: #e0e0e0; }
        .badge-rarity-rare { background: #bbdefb; }
        .badge-rarity-epic { background: #ce93d8; }
        .badge-rarity-legendary { background: #ffcc80; }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            text-align: left;
        }
        
        .modal-close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }
        
        .modal-close:hover {
            color: #333;
        }
        
        /* å˜é‡æŒ‰é’® */
        .variable-btn {
            background: #e3f2fd;
            border: 1px solid #2196F3;
            padding: 5px 10px;
            margin: 2px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .variable-btn:hover {
            background: #bbdefb;
        }
        
        /* é¢„è§ˆæ¡† */
        .preview-box {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <h1>ğŸ† ç­‰çº§ç³»ç»Ÿç®¡ç†ä¸­å¿ƒ</h1>
        
        <!-- ç³»ç»ŸçŠ¶æ€ -->
        <div class="system-status">
            <div>
                <strong>ç­‰çº§ç³»ç»ŸçŠ¶æ€ï¼š</strong>
                <span id="systemStatus" class="status-enabled">å·²å¯ç”¨</span>
                <span style="margin-left: 20px;">æ•°æ®åº“ï¼šlevel_system.db</span>
            </div>
            <div>
                <button class="btn btn-warning" onclick="toggleLevelSystem()">åˆ‡æ¢çŠ¶æ€</button>
                <button class="btn btn-primary" onclick="manualRefresh()" style="margin-left: 10px;">ğŸ”„ åˆ·æ–°æ•°æ®</button>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>ğŸ‘¥ æ€»ç”¨æˆ·æ•°</h3>
                <div class="stat-value" id="totalUsers">-</div>
            </div>
            <div class="stat-card">
                <h3>ğŸ† æ€»ç§¯åˆ†å‘æ”¾</h3>
                <div class="stat-value" id="totalPoints">-</div>
            </div>
            <div class="stat-card">
                <h3>â­ å¹³å‡ç­‰çº§</h3>
                <div class="stat-value" id="avgLevel">-</div>
            </div>
            <div class="stat-card">
                <h3>ğŸ–ï¸ å‹‹ç« æ€»æ•°</h3>
                <div class="stat-value" id="totalBadges">-</div>
            </div>
        </div>
        
        <!-- æ ‡ç­¾é¡µ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('users')">ğŸ‘¥ ç”¨æˆ·ç®¡ç†</button>
            <button class="tab" onclick="switchTab('levels')">â­ ç­‰çº§é…ç½®</button>
            <button class="tab" onclick="switchTab('rewards')">ğŸ å¥–åŠ±è§„åˆ™</button>
            <button class="tab" onclick="switchTab('badges')">ğŸ† å‹‹ç« ç®¡ç†</button>
            <button class="tab" onclick="switchTab('broadcast')">ğŸ“¢ æ’­æŠ¥é…ç½®</button>
            <button class="tab" onclick="switchTab('groups')">ğŸ‘¥ ç¾¤ç»„ç®¡ç†</button>
            <button class="tab" onclick="switchTab('data')">ğŸ’¾ æ•°æ®ç®¡ç†</button>
        </div>
        
        <!-- ç”¨æˆ·ç®¡ç† -->
        <div id="users-tab" class="tab-content active">
            <div class="form-section">
                <h2>ğŸ” ç”¨æˆ·æœç´¢</h2>
                <div class="form-grid">
                    <div>
                        <input type="text" id="userSearchInput" placeholder="è¾“å…¥ç”¨æˆ·IDæˆ–æ˜¾ç¤ºåç§°">
                        <button class="btn btn-primary" onclick="searchUser()">æœç´¢</button>
                    </div>
                </div>
                
                <div id="userSearchResult" style="display: none;">
                    <!-- æœç´¢ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                </div>
            </div>
            
            <div class="form-section">
                <h2>ğŸ“Š ç”¨æˆ·æ’è¡Œæ¦œ</h2>
                <div style="margin-bottom: 15px;">
                    <label>
                        <input type="checkbox" id="showActiveUsersOnly" checked onchange="toggleUserFilter()">
                        åªæ˜¾ç¤ºæœ‰è¯„ä»·è®°å½•çš„ç”¨æˆ·
                    </label>
                    <span style="margin-left: 10px; color: #666; font-size: 14px;">
                        ï¼ˆå–æ¶ˆå‹¾é€‰å°†æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·ï¼‰
                    </span>
                </div>
                <table class="config-table">
                    <thead>
                        <tr>
                            <th>æ’å</th>
                            <th>ç”¨æˆ·ID</th>
                            <th>ç”¨æˆ·åç§°</th>
                            <th>@ç”¨æˆ·å</th>
                            <th>ç­‰çº§</th>
                            <th>ç»éªŒå€¼</th>
                            <th>ç§¯åˆ†</th>
                            <th>è¯„ä»·æ•°</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="userRankingBody">
                        <tr><td colspan="9" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ç­‰çº§é…ç½® -->
        <div id="levels-tab" class="tab-content">
            <div class="form-section">
                <h2>âš™ï¸ ç­‰çº§é…ç½®ç®¡ç†</h2>
                
                <div class="form-group">
                    <label>é€‰æ‹©ç¾¤ç»„ï¼š</label>
                    <select id="levelGroupSelect" onchange="loadGroupLevelConfig()">
                        <option value="">è¯·é€‰æ‹©ç¾¤ç»„</option>
                    </select>
                    <button class="btn btn-success" onclick="createNewGroup()">åˆ›å»ºæ–°ç¾¤ç»„</button>
                </div>
                
                <table class="config-table" id="levelConfigTable">
                    <thead>
                        <tr>
                            <th>ç­‰çº§</th>
                            <th>ç­‰çº§åç§°</th>
                            <th>æ‰€éœ€ç»éªŒå€¼</th>
                            <th>æ‰€éœ€è¯„ä»·æ¬¡æ•°</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="levelConfigBody">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
                
                <button class="btn btn-primary" onclick="addLevelRow()">â• æ·»åŠ ç­‰çº§</button>
                <button class="btn btn-success" onclick="saveLevelConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                <button class="btn btn-warning" onclick="resetLevelConfig()">ğŸ”„ é‡ç½®ä¸ºé»˜è®¤</button>
            </div>
        </div>
        
        <!-- å¥–åŠ±è§„åˆ™ -->
        <div id="rewards-tab" class="tab-content">
            <div class="form-section">
                <h2>ğŸ å¥–åŠ±è§„åˆ™é…ç½®</h2>
                
                <h3>åŸºç¡€å¥–åŠ±ï¼ˆç»éªŒå€¼ + ç§¯åˆ†ï¼‰</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ğŸ¯ å®Œæˆå‡ºå‡»</label>
                        <input type="number" id="attackExp" placeholder="ç»éªŒå€¼" value="20">
                        <input type="number" id="attackPoints" placeholder="ç§¯åˆ†" value="10">
                    </div>
                    <div class="form-group">
                        <label>ğŸ“ 12é¡¹è¯„ä»·</label>
                        <input type="number" id="userEvalExp" placeholder="ç»éªŒå€¼" value="30">
                        <input type="number" id="userEvalPoints" placeholder="ç§¯åˆ†" value="25">
                    </div>
                    <div class="form-group">
                        <label>ğŸª å•†å®¶è¯„ä»·</label>
                        <input type="number" id="merchantEvalExp" placeholder="ç»éªŒå€¼" value="25">
                        <input type="number" id="merchantEvalPoints" placeholder="ç§¯åˆ†" value="20">
                    </div>
                    <div class="form-group">
                        <label>âœï¸ æ–‡å­—è¯„ä»·</label>
                        <input type="number" id="textEvalExp" placeholder="ç»éªŒå€¼" value="15">
                        <input type="number" id="textEvalPoints" placeholder="ç§¯åˆ†" value="15">
                    </div>
                </div>
                
                <h3>ç‰¹æ®Šå¥–åŠ±</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ğŸ’¯ æ»¡åˆ†å¥–åŠ±</label>
                        <input type="number" id="perfectScoreExp" placeholder="é¢å¤–ç»éªŒå€¼" value="50">
                        <input type="number" id="perfectScorePoints" placeholder="é¢å¤–ç§¯åˆ†" value="100">
                    </div>
                    <div class="form-group">
                        <label>ğŸŠ å‡çº§å¥–åŠ±</label>
                        <input type="number" id="levelUpPoints" placeholder="å¥–åŠ±ç§¯åˆ†" value="50">
                    </div>
                </div>
                
                <h3>å¥–åŠ±å€æ•°</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ç»éªŒå€¼å€æ•°</label>
                        <input type="number" id="expMultiplier" step="0.1" value="1.0">
                    </div>
                    <div class="form-group">
                        <label>ç§¯åˆ†å€æ•°</label>
                        <input type="number" id="pointsMultiplier" step="0.1" value="1.0">
                    </div>
                    <div class="form-group">
                        <label>å‘¨æœ«å¥–åŠ±å€æ•°</label>
                        <input type="number" id="weekendBonus" step="0.1" value="1.2">
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="saveRewardsConfig()">ğŸ’¾ ä¿å­˜å¥–åŠ±é…ç½®</button>
            </div>
        </div>
        
        <!-- å‹‹ç« ç®¡ç† -->
        <div id="badges-tab" class="tab-content">
            <div class="form-section">
                <h2>ğŸ† å‹‹ç« ç®¡ç†</h2>
                
                <button class="btn btn-primary" onclick="showCreateBadgeModal()">â• åˆ›å»ºæ–°å‹‹ç« </button>
                
                <div id="badgesList" style="margin-top: 20px;">
                    <!-- å‹‹ç« åˆ—è¡¨ -->
                </div>
            </div>
        </div>
        
        <!-- æ’­æŠ¥é…ç½® -->
        <div id="broadcast-tab" class="tab-content">
            <div class="form-section">
                <h2>ğŸ“¢ æ’­æŠ¥é…ç½®</h2>
                
                <h3>æ’­æŠ¥å¼€å…³</h3>
                <div class="form-grid">
                    <label><input type="checkbox" id="enableLevelUp" checked> å‡çº§æ’­æŠ¥</label>
                    <label><input type="checkbox" id="enableBadgeUnlock" checked> å‹‹ç« è§£é”æ’­æŠ¥</label>
                    <label><input type="checkbox" id="enableMilestone"> é‡Œç¨‹ç¢‘æ’­æŠ¥</label>
                    <label><input type="checkbox" id="enablePerfectScore"> æ»¡åˆ†æ’­æŠ¥</label>
                </div>
                
                <h3>æ’­æŠ¥æ¨¡æ¿</h3>
                <div class="form-group">
                    <label>å‡çº§æ’­æŠ¥æ¨¡æ¿ï¼š</label>
                    <textarea id="levelUpTemplate" rows="5">ğŸ‰ æ­å–œ {{user_name}} å‡çº§äº†ï¼
â­ Lv.{{old_level}} â†’ Lv.{{new_level}} {{level_name}}
ğŸ’ å‡çº§å¥–åŠ±ï¼š{{level_up_points}}ç§¯åˆ†
ç»§ç»­åŠªåŠ›ï¼Œæˆä¸ºä¼ è¯´å‹‡å£«ï¼ğŸ’ª</textarea>
                    <div class="variable-list">
                        å¯ç”¨å˜é‡ï¼š
                        <button class="variable-btn" onclick="insertVariable('levelUpTemplate', '{{user_name}}')">{{user_name}}</button>
                        <button class="variable-btn" onclick="insertVariable('levelUpTemplate', '{{old_level}}')">{{old_level}}</button>
                        <button class="variable-btn" onclick="insertVariable('levelUpTemplate', '{{new_level}}')">{{new_level}}</button>
                        <button class="variable-btn" onclick="insertVariable('levelUpTemplate', '{{level_name}}')">{{level_name}}</button>
                        <button class="variable-btn" onclick="insertVariable('levelUpTemplate', '{{level_up_points}}')">{{level_up_points}}</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>å‹‹ç« è§£é”æ¨¡æ¿ï¼š</label>
                    <textarea id="badgeUnlockTemplate" rows="4">ğŸ† {{user_name}} è§£é”äº†æ–°å‹‹ç« ï¼
{{badge_emoji}} {{badge_name}}
{{badge_desc}}</textarea>
                    <div class="variable-list">
                        å¯ç”¨å˜é‡ï¼š
                        <button class="variable-btn" onclick="insertVariable('badgeUnlockTemplate', '{{user_name}}')">{{user_name}}</button>
                        <button class="variable-btn" onclick="insertVariable('badgeUnlockTemplate', '{{badge_emoji}}')">{{badge_emoji}}</button>
                        <button class="variable-btn" onclick="insertVariable('badgeUnlockTemplate', '{{badge_name}}')">{{badge_name}}</button>
                        <button class="variable-btn" onclick="insertVariable('badgeUnlockTemplate', '{{badge_desc}}')">{{badge_desc}}</button>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="saveBroadcastConfig()">ğŸ’¾ ä¿å­˜æ’­æŠ¥é…ç½®</button>
                <button class="btn btn-primary" onclick="testBroadcast()">ğŸ§ª æµ‹è¯•æ’­æŠ¥</button>
            </div>
        </div>
        
        <!-- ç¾¤ç»„ç®¡ç† -->
        <div id="groups-tab" class="tab-content">
            <div class="form-section">
                <h2>ğŸ‘¥ ç¾¤ç»„ç®¡ç†</h2>
                
                <!-- ä½¿ç”¨æŒ‡å— -->
                <div id="groupsGuide" class="info-box" style="background: #e8f4fd; border: 1px solid #b3d4fc; margin-bottom: 20px;">
                    <h3 style="color: #1565c0; margin-top: 0;">ğŸ® å¼€å§‹ä½¿ç”¨ç­‰çº§ç³»ç»Ÿ</h3>
                    <div style="color: #1565c0;">
                        <p><strong>ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Ÿ</strong>è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
                        <ol style="margin: 10px 0; padding-left: 20px;">
                            <li>ç‚¹å‡»"â• åˆ›å»ºæ–°ç¾¤ç»„"æŒ‰é’®</li>
                            <li>è¾“å…¥æ‚¨çš„Telegramç¾¤ç»„IDï¼ˆä¾‹å¦‚ï¼š-1002793326688ï¼‰</li>
                            <li>è®¾ç½®ç¾¤ç»„åç§°ï¼ˆä¾‹å¦‚ï¼šä¸Šæµ·å°é¸¡ç®¡å®¶ç¾¤ï¼‰</li>
                            <li>ä¿å­˜åå³å¯åœ¨ç¾¤ç»„ä¸­ä½¿ç”¨ <code>/level</code> å‘½ä»¤</li>
                        </ol>
                        <p><strong>ğŸ’¡ å¦‚ä½•è·å–ç¾¤ç»„IDï¼Ÿ</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>åœ¨ç¾¤ç»„ä¸­å‘é€æ¶ˆæ¯ï¼ŒæŸ¥çœ‹Botæ—¥å¿—</li>
                            <li>ä½¿ç”¨ @userinfobot ç­‰æœºå™¨äººè·å–</li>
                            <li>ç¾¤ç»„IDé€šå¸¸ä»¥ -100 å¼€å¤´</li>
                        </ul>
                    </div>
                </div>
                
                <table class="config-table">
                    <thead>
                        <tr>
                            <th>ç¾¤ç»„ID</th>
                            <th>ç¾¤ç»„åç§°</th>
                            <th>ç”¨æˆ·æ•°</th>
                            <th>çŠ¶æ€</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="groupsTableBody">
                        <tr><td colspan="5" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="showCreateGroupModal()" style="font-size: 16px; padding: 12px 24px;">
                        â• åˆ›å»ºæ–°ç¾¤ç»„
                    </button>
                    <button class="btn btn-success" onclick="loadGroups()" style="margin-left: 10px;">
                        ğŸ”„ åˆ·æ–°åˆ—è¡¨
                    </button>
                </div>
            </div>
        </div>
        
        <!-- æ•°æ®ç®¡ç† -->
        <div id="data-tab" class="tab-content">
            <div class="form-section">
                <h2>ğŸ’¾ æ•°æ®ç®¡ç†</h2>
                
                <div class="info-box">
                    <p><strong>æ•°æ®åº“æ–‡ä»¶ï¼š</strong>level_system.db</p>
                    <p><strong>æ•°æ®åº“å¤§å°ï¼š</strong><span id="dbSize">-</span></p>
                    <p><strong>æœ€åæ›´æ–°ï¼š</strong><span id="lastUpdate">-</span></p>
                </div>
                
                <!-- è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯ -->
                <div id="detailedStatsContainer">
                    <div class="loading-text">æ­£åœ¨åŠ è½½è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯...</div>
                </div>
                
                <h3>ğŸ“¤ æ•°æ®å¯¼å‡º <span style="color: #ff9800; font-size: 14px;">(åŠŸèƒ½å¼€å‘ä¸­)</span></h3>
                <div class="form-grid">
                    <button class="btn btn-primary" onclick="exportAllData()" style="opacity: 0.8;" title="åŠŸèƒ½å¼€å‘ä¸­">ğŸ“¤ å¯¼å‡ºå®Œæ•´æ•°æ®</button>
                    <button class="btn btn-primary" onclick="exportUserData()" style="opacity: 0.8;" title="åŠŸèƒ½å¼€å‘ä¸­">ğŸ‘¥ å¯¼å‡ºç”¨æˆ·æ•°æ®</button>
                    <button class="btn btn-primary" onclick="exportConfig()" style="opacity: 0.8;" title="åŠŸèƒ½å¼€å‘ä¸­">âš™ï¸ å¯¼å‡ºé…ç½®</button>
                </div>
                
                <h3>ğŸ“¥ æ•°æ®å¯¼å…¥ <span style="color: #ff9800; font-size: 14px;">(åŠŸèƒ½å¼€å‘ä¸­)</span></h3>
                <div class="warning-box">
                    âš ï¸ å¯¼å…¥æ•°æ®ä¼šè¦†ç›–ç°æœ‰æ•°æ®ï¼Œè¯·è°¨æ…æ“ä½œï¼
                </div>
                <div class="form-grid">
                    <input type="file" id="importFile" accept=".json" disabled>
                    <button class="btn btn-warning" onclick="importData()" style="opacity: 0.8;" title="åŠŸèƒ½å¼€å‘ä¸­">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                </div>
                
                <h3>ğŸ”„ ç¾¤ç»„è¿ç§» <span style="color: #ff9800; font-size: 14px;">(åŠŸèƒ½å¼€å‘ä¸­)</span></h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>æºç¾¤ç»„ï¼š</label>
                        <select id="sourceGroup" disabled>
                            <option value="">é€‰æ‹©æºç¾¤ç»„</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ç›®æ ‡ç¾¤ç»„IDï¼š</label>
                        <input type="text" id="targetGroupId" placeholder="-1001234567890" disabled>
                    </div>
                </div>
                <button class="btn btn-warning" onclick="migrateGroup()" style="opacity: 0.8;" title="åŠŸèƒ½å¼€å‘ä¸­">ğŸ”„ è¿ç§»ç¾¤ç»„</button>
                
                <h3>ğŸ› ï¸ æ•°æ®åº“ç»´æŠ¤ <span style="color: #ff9800; font-size: 14px;">(åŠŸèƒ½å¼€å‘ä¸­)</span></h3>
                <div class="form-grid">
                    <button class="btn btn-info" onclick="cleanupData()" style="opacity: 0.8;" title="åŠŸèƒ½å¼€å‘ä¸­">ğŸ§¹ æ¸…ç†æ— æ•ˆæ•°æ®</button>
                    <button class="btn btn-success" onclick="optimizeDatabase()" style="opacity: 0.8;" title="åŠŸèƒ½å¼€å‘ä¸­">âš¡ ä¼˜åŒ–æ•°æ®åº“</button>
                </div>
                
                <h3>ğŸ’¾ æ•°æ®åº“å¤‡ä»½ <span style="color: #ff9800; font-size: 14px;">(åŠŸèƒ½å¼€å‘ä¸­)</span></h3>
                <div class="form-grid">
                    <button class="btn btn-primary" onclick="createBackup()" style="opacity: 0.8;" title="åŠŸèƒ½å¼€å‘ä¸­">ğŸ’¾ åˆ›å»ºå¤‡ä»½</button>
                    <div class="form-group">
                        <input type="file" id="backupFile" accept=".db,.sqlite,.sqlite3" disabled>
                        <button class="btn btn-danger" onclick="restoreBackup()" style="opacity: 0.8;" title="åŠŸèƒ½å¼€å‘ä¸­">ğŸ”„ æ¢å¤å¤‡ä»½</button>
                    </div>
                </div>
                
                <div class="warning-box">
                    âš ï¸ æ•°æ®åº“ç»´æŠ¤æ“ä½œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚å»ºè®®åœ¨ç»´æŠ¤å‰åˆ›å»ºå¤‡ä»½ã€‚
                </div>
            </div>
        </div>
    </div>
    
    <!-- åˆ›å»ºå‹‹ç« æ¨¡æ€æ¡† -->
    <div id="createBadgeModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('createBadgeModal')">&times;</span>
            <h2>âœ¨ åˆ›å»ºæ–°å‹‹ç« </h2>
            
            <div class="form-group">
                <label>å‹‹ç« IDï¼š</label>
                <input type="text" id="newBadgeId" placeholder="ä¾‹å¦‚ï¼šperfect_warrior">
            </div>
            
            <div class="form-group">
                <label>å‹‹ç« åç§°ï¼š</label>
                <input type="text" id="newBadgeName" placeholder="ä¾‹å¦‚ï¼šå®Œç¾æˆ˜å£«">
            </div>
            
            <div class="form-group">
                <label>å‹‹ç« å›¾æ ‡ï¼š</label>
                <input type="text" id="newBadgeEmoji" placeholder="ä¾‹å¦‚ï¼šğŸ†" value="ğŸ†">
            </div>
            
            <div class="form-group">
                <label>å‹‹ç« æè¿°ï¼š</label>
                <textarea id="newBadgeDesc" placeholder="ä¾‹å¦‚ï¼šè¿ç»­10æ¬¡è·å¾—æ»¡åˆ†è¯„ä»·"></textarea>
            </div>
            
            <div class="form-group">
                <label>ç¨€æœ‰åº¦ï¼š</label>
                <select id="newBadgeRarity">
                    <option value="common">æ™®é€š âšª</option>
                    <option value="rare">ç¨€æœ‰ ğŸ”µ</option>
                    <option value="epic">å²è¯— ğŸŸ£</option>
                    <option value="legendary">ä¼ è¯´ ğŸŸ¡</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>è§£é”æ¡ä»¶ç±»å‹ï¼š</label>
                <select id="badgeConditionType" onchange="updateConditionForm()">
                    <option value="stat_based">åŸºäºç»Ÿè®¡æ•°æ®</option>
                    <option value="evaluation_streak">è¯„ä»·è¿å‡»</option>
                    <option value="manual">æ‰‹åŠ¨æˆäºˆ</option>
                </select>
            </div>
            
            <div id="conditionDetails">
                <!-- åŠ¨æ€ç”Ÿæˆæ¡ä»¶è¡¨å• -->
            </div>
            
            <button class="btn btn-success" onclick="createBadge()">åˆ›å»ºå‹‹ç« </button>
        </div>
    </div>

    <!-- ç¼–è¾‘å‹‹ç« æ¨¡æ€æ¡† -->
    <div id="editBadgeModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('editBadgeModal')">&times;</span>
            <h2>âœï¸ ç¼–è¾‘å‹‹ç« </h2>
            
            <div class="form-group">
                <label>å‹‹ç« IDï¼š</label>
                <input type="text" id="editBadgeId" readonly style="background: #f5f5f5;">
                <small style="color: #666;">å‹‹ç« IDä¸å¯ä¿®æ”¹</small>
            </div>
            
            <div class="form-group">
                <label>å‹‹ç« åç§°ï¼š</label>
                <input type="text" id="editBadgeName" placeholder="ä¾‹å¦‚ï¼šå®Œç¾æˆ˜å£«">
            </div>
            
            <div class="form-group">
                <label>å‹‹ç« å›¾æ ‡ï¼š</label>
                <input type="text" id="editBadgeEmoji" placeholder="ä¾‹å¦‚ï¼šğŸ†">
            </div>
            
            <div class="form-group">
                <label>å‹‹ç« æè¿°ï¼š</label>
                <textarea id="editBadgeDesc" placeholder="ä¾‹å¦‚ï¼šè¿ç»­10æ¬¡è·å¾—æ»¡åˆ†è¯„ä»·"></textarea>
            </div>
            
            <div class="form-group">
                <label>ç¨€æœ‰åº¦ï¼š</label>
                <select id="editBadgeRarity">
                    <option value="common">æ™®é€š âšª</option>
                    <option value="rare">ç¨€æœ‰ ğŸ”µ</option>
                    <option value="epic">å²è¯— ğŸŸ£</option>
                    <option value="legendary">ä¼ è¯´ ğŸŸ¡</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>è§£é”æ¡ä»¶ç±»å‹ï¼š</label>
                <select id="editBadgeConditionType" onchange="updateEditConditionForm()">
                    <option value="stat_based">åŸºäºç»Ÿè®¡æ•°æ®</option>
                    <option value="evaluation_streak">è¯„ä»·è¿å‡»</option>
                    <option value="manual">æ‰‹åŠ¨æˆäºˆ</option>
                </select>
            </div>
            
            <div id="editConditionDetails">
                <!-- åŠ¨æ€ç”Ÿæˆæ¡ä»¶è¡¨å• -->
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('editBadgeModal')">å–æ¶ˆ</button>
                <button class="btn btn-success" onclick="updateBadge()">ğŸ’¾ ä¿å­˜ä¿®æ”¹</button>
            </div>
        </div>
    </div>
    
    <!-- åˆ›å»ºç¾¤ç»„æ¨¡æ€æ¡† -->
    <div id="createGroupModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="modal-close" onclick="closeModal('createGroupModal')">&times;</span>
            <h2>â• åˆ›å»ºæ–°ç¾¤ç»„é…ç½®</h2>
            
            <div class="info-box" style="background: #fff3cd; border: 1px solid #ffeaa7; margin-bottom: 20px;">
                <h4 style="color: #856404; margin-top: 0;">ğŸ“‹ é…ç½®è¯´æ˜</h4>
                <p style="color: #856404; margin: 5px 0;">åˆ›å»ºç¾¤ç»„é…ç½®åï¼Œç”¨æˆ·å°±å¯ä»¥åœ¨å¯¹åº”çš„Telegramç¾¤ç»„ä¸­ä½¿ç”¨ç­‰çº§ç³»ç»ŸåŠŸèƒ½äº†ã€‚</p>
            </div>
            
            <div class="form-group">
                <label><strong>ç¾¤ç»„IDï¼š</strong></label>
                <input type="text" id="newGroupId" placeholder="ä¾‹å¦‚ï¼š-1002793326688" style="font-family: monospace;">
                <small style="display: block; color: #666; margin-top: 5px;">
                    <strong>é‡è¦ï¼š</strong>è¯·è¾“å…¥æ‚¨çš„Telegramç¾¤ç»„IDï¼ˆé€šå¸¸ä»¥-100å¼€å¤´çš„è´Ÿæ•°ï¼‰<br>
                    ğŸ’¡ æ‚¨å¯ä»¥åœ¨ç¾¤ç»„ä¸­å‘é€ä»»æ„æ¶ˆæ¯ï¼Œç„¶åæŸ¥çœ‹Botæ—¥å¿—è·å–ç¾¤ç»„ID
                </small>
            </div>
            
            <div class="form-group">
                <label><strong>ç¾¤ç»„åç§°ï¼š</strong></label>
                <input type="text" id="newGroupName" placeholder="ä¾‹å¦‚ï¼šä¸Šæµ·å°é¸¡ç®¡å®¶ç¾¤">
                <small style="display: block; color: #666; margin-top: 5px;">
                    ç”¨äºåœ¨ç®¡ç†ç•Œé¢ä¸­è¯†åˆ«ç¾¤ç»„ï¼Œå¯ä»¥è®¾ç½®ä¸ºä»»æ„å‹å¥½çš„åç§°
                </small>
            </div>
            
            <div class="info-box" style="background: #e8f4fd; border: 1px solid #b3d4fc; margin: 20px 0;">
                <h4 style="color: #1565c0; margin-top: 0;">ğŸš€ åˆ›å»ºåå¯ä»¥åšä»€ä¹ˆï¼Ÿ</h4>
                <ul style="color: #1565c0; margin: 5px 0; padding-left: 20px;">
                    <li>åœ¨ç¾¤ç»„ä¸­ä½¿ç”¨ <code>/level</code> æŸ¥çœ‹ç­‰çº§ä¿¡æ¯</li>
                    <li>ä½¿ç”¨ <code>/badges</code> æŸ¥çœ‹å‹‹ç« æ”¶é›†</li>
                    <li>ä½¿ç”¨ <code>/ranking</code> æŸ¥çœ‹æ’è¡Œæ¦œ</li>
                    <li>é€šè¿‡ç®¡ç†é¢æ¿é…ç½®ç­‰çº§ã€ç§¯åˆ†ã€å‹‹ç« ç­‰</li>
                </ul>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="closeModal('createGroupModal')">å–æ¶ˆ</button>
                <button class="btn btn-success" onclick="createGroup()" style="font-size: 16px; padding: 10px 20px;">
                    âœ… åˆ›å»ºç¾¤ç»„é…ç½®
                </button>
            </div>
        </div>
    </div>
    
    <!-- ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="userDetailModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('userDetailModal')">&times;</span>
            <h2>ğŸ‘¤ ç”¨æˆ·è¯¦æƒ…</h2>
            
            <div id="userDetailContent">
                <!-- ç”¨æˆ·è¯¦æƒ…å†…å®¹ -->
            </div>
            
            <h3>è°ƒæ•´ç­‰çº§æ•°æ®</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>ç»éªŒå€¼è°ƒæ•´ï¼š</label>
                    <input type="number" id="adjustExp" placeholder="æ­£æ•°å¢åŠ ï¼Œè´Ÿæ•°å‡å°‘">
                </div>
                <div class="form-group">
                    <label>ç§¯åˆ†è°ƒæ•´ï¼š</label>
                    <input type="number" id="adjustPoints" placeholder="æ­£æ•°å¢åŠ ï¼Œè´Ÿæ•°å‡å°‘">
                </div>
            </div>
            <div class="form-group">
                <label>è°ƒæ•´åŸå› ï¼š</label>
                <input type="text" id="adjustReason" placeholder="è¯·è¾“å…¥è°ƒæ•´åŸå› ">
            </div>
            <button class="btn btn-warning" onclick="adjustUserData()" style="opacity: 0.8;" title="åŠŸèƒ½å³å°†ä¸Šçº¿">æ‰§è¡Œè°ƒæ•´ <span style="color: #ff9800; font-size: 12px;">(å³å°†ä¸Šçº¿)</span></button>
            
            <h3>æˆäºˆå‹‹ç«  <span style="color: #ff9800; font-size: 14px;">(å³å°†ä¸Šçº¿)</span></h3>
            <div class="form-group">
                <select id="awardBadgeSelect" disabled>
                    <option value="">é€‰æ‹©å‹‹ç« </option>
                </select>
                <button class="btn btn-success" onclick="awardBadge()" style="opacity: 0.8;" title="åŠŸèƒ½å³å°†ä¸Šçº¿">æˆäºˆå‹‹ç« </button>
            </div>
        </div>
    </div>
    
    <!-- æ¶ˆæ¯å®¹å™¨ -->
    <div id="messageContainer"></div>
    
    <!-- ç¾¤ç»„é…ç½®ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="editGroupConfigModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="modal-close" onclick="closeModal('editGroupConfigModal')">&times;</span>
            <h2>âš™ï¸ ç¼–è¾‘ç¾¤ç»„é…ç½®</h2>
            
            <div class="form-section">
                <h3>åŸºæœ¬ä¿¡æ¯</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ç¾¤ç»„IDï¼š</label>
                        <input type="text" id="editGroupId" readonly>
                    </div>
                    <div class="form-group">
                        <label>ç¾¤ç»„åç§°ï¼š</label>
                        <input type="text" id="editGroupName" placeholder="è¯·è¾“å…¥ç¾¤ç»„åç§°">
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>ç³»ç»Ÿè®¾ç½®</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label><input type="checkbox" id="editEnableLevelSystem"> å¯ç”¨ç­‰çº§ç³»ç»Ÿ</label>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="editEnablePointsSystem"> å¯ç”¨ç§¯åˆ†ç³»ç»Ÿ</label>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="editEnableRanking"> å¯ç”¨æ’è¡Œæ¦œ</label>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="editEnableNotifications"> å¯ç”¨é€šçŸ¥æ’­æŠ¥</label>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>å¿«é€Ÿé…ç½®</h3>
                <div class="form-grid">
                    <button class="btn btn-primary" onclick="openLevelConfigEditor()">ğŸ“Š ç­‰çº§é…ç½®</button>
                    <button class="btn btn-primary" onclick="openPointsConfigEditor()">ğŸ’° ç§¯åˆ†é…ç½®</button>
                    <button class="btn btn-primary" onclick="openBroadcastConfigEditor()">ğŸ“¢ æ’­æŠ¥é…ç½®</button>
                    <button class="btn btn-primary" onclick="openBadgeConfigEditor()">ğŸ† å‹‹ç« é…ç½®</button>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('editGroupConfigModal')">å–æ¶ˆ</button>
                <button class="btn btn-success" onclick="saveGroupConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="userDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="modal-close" onclick="closeModal('userDetailsModal')">&times;</span>
            <div id="userDetailsContent">
                <!-- ç”¨æˆ·è¯¦æƒ…å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·æ•°æ®è°ƒæ•´æ¨¡æ€æ¡† -->
    <div id="userAdjustModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="modal-close" onclick="closeModal('userAdjustModal')">&times;</span>
            <h2 id="adjustModalTitle">è°ƒæ•´ç”¨æˆ·æ•°æ®</h2>
            
            <div class="info-box">
                <strong>ç”¨æˆ·:</strong> <span id="adjustUserName"></span><br>
                <span id="adjustModalDesc"></span>
            </div>
            
            <input type="hidden" id="adjustUserId">
            <input type="hidden" id="adjustType">
            
            <div class="form-group">
                <label>è°ƒæ•´æ•°å€¼:</label>
                <input type="number" id="adjustAmount" placeholder="æ­£æ•°å¢åŠ ï¼Œè´Ÿæ•°å‡å°‘" step="1">
                <small style="display: block; color: #666; margin-top: 5px;">
                    è¾“å…¥æ­£æ•°å¢åŠ ï¼Œè´Ÿæ•°å‡å°‘ã€‚ä¾‹å¦‚ï¼š+100 æˆ– -50
                </small>
            </div>
            
            <div class="form-group">
                <label>è°ƒæ•´åŸå› :</label>
                <textarea id="adjustReason" placeholder="è¯·è¾“å…¥è°ƒæ•´åŸå› ï¼Œæ­¤ä¿¡æ¯å°†è®°å½•åœ¨ç³»ç»Ÿæ—¥å¿—ä¸­" rows="3"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('userAdjustModal')">å–æ¶ˆ</button>
                <button class="btn btn-warning" onclick="confirmUserAdjustment()">ç¡®è®¤è°ƒæ•´</button>
            </div>
        </div>
    </div>

    <!-- ç®¡ç†å‘˜å¯†ç éªŒè¯æ¨¡æ€æ¡† -->
    <div id="adminPasswordModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('adminPasswordModal')">&times;</span>
            <h2>ğŸ” ç®¡ç†å‘˜å¯†ç éªŒè¯</h2>
            <p id="passwordPromptText">æ­¤æ“ä½œéœ€è¦ç®¡ç†å‘˜å¯†ç éªŒè¯ï¼Œè¯·è¾“å…¥å¯†ç ï¼š</p>
            
            <div class="form-group">
                <label>ç®¡ç†å‘˜å¯†ç ï¼š</label>
                <input type="password" id="adminPasswordInput" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeModal('adminPasswordModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmAdminAction()">ç¡®è®¤</button>
            </div>
        </div>
    </div>
    
    <script src="/level/admin/level-system.js"></script>
</body>
</html> 